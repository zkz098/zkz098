const statics=0<CONFIG.statics.indexOf("//")?CONFIG.statics:CONFIG.root,scrollAction={x:void 0,y:void 0};let diffY=0,originTitle,titleTime;const BODY=document.getElementsByTagName("body")[0],HTML=document.documentElement,Container=$dom("#container"),loadCat=$dom("#loading"),siteNav=$dom("#nav"),siteHeader=$dom("#header"),menuToggle=siteNav.child(".toggle"),quickBtn=$dom("#quick"),sideBar=$dom("#sidebar"),siteBrand=$dom("#brand");let toolBtn=$dom("#tool"),toolPlayer,backToTop,goToComment,showContents,siteSearch=$dom("#search"),siteNavHeight,headerHightInner,headerHight,oWinHeight=window.innerHeight,oWinWidth=window.innerWidth,LOCAL_HASH=0,LOCAL_URL=window.location.href,pjax;const changeTheme=function(e){const t=$dom(".theme .ic");"dark"===e?(HTML.attr("data-theme",e),t.removeClass("i-sun"),t.addClass("i-moon")):(HTML.attr("data-theme",null),t.removeClass("i-moon"),t.addClass("i-sun"))},autoDarkmode=function(){CONFIG.auto_dark.enable&&((new Date).getHours()>=CONFIG.auto_dark.start||(new Date).getHours()<=CONFIG.auto_dark.end||window.matchMedia("(prefers-color-scheme:dark)").matches?changeTheme("dark"):changeTheme())},lazyload=lozad("img, [data-background-image]",{loaded:function(e){e.addClass("lozaded")}}),Loader={timer:null,lock:!1,show:function(){clearTimeout(this.timer),document.body.removeClass("loaded"),loadCat.attr("style","display:block"),Loader.lock=!1},hide:function(e){CONFIG.loader.start||(e=-1),this.timer=setTimeout(this.vanish,e||3e3)},vanish:function(){Loader.lock||(CONFIG.loader.start&&transition(loadCat,0),document.body.addClass("loaded"),Loader.lock=!0)}},changeMetaTheme=function(e){"dark"===HTML.attr("data-theme")&&(e="#222"),$dom('meta[name="theme-color"]').attr("content",e)},themeColorListener=function(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(e){e.matches?changeTheme("dark"):changeTheme()});var e=$storage.get("theme");e?changeTheme(e):CONFIG.darkmode&&changeTheme("dark"),$dom(".theme").addEventListener("click",function(e){let t;function o(){transition(n,{delay:2500,opacity:0},function(){BODY.removeChild(n)})}const i=e.currentTarget,a=i.child(".ic"),n=BODY.createChild("div",{id:"neko",innerHTML:'<div class="planet"><div class="sun"></div><div class="moon"></div></div><div class="body"><div class="face"><section class="eyes left"><span class="pupil"></span></section><section class="eyes right"><span class="pupil"></span></section><span class="nose"></span></div></div>'});t=a.hasClass("i-sun")?function(){n.addClass("dark"),changeTheme("dark"),$storage.set("theme","dark"),o()}:(n.addClass("dark"),function(){n.removeClass("dark"),changeTheme(),$storage.set("theme","light"),o()}),transition(n,1,function(){setTimeout(t,210)})})},visibilityListener=function(){let e=$dom('[rel="icon"]');document.addEventListener("visibilitychange",function(){switch(document.visibilityState){case"hidden":e.attr("href",statics+CONFIG.favicon.hidden),document.title=LOCAL.favicon.hide,CONFIG.loader.switch&&Loader.show(),clearTimeout(titleTime);break;case"visible":e.attr("href",statics+CONFIG.favicon.normal),document.title=LOCAL.favicon.show,CONFIG.loader.switch&&Loader.hide(1e3),titleTime=setTimeout(function(){document.title=originTitle},2e3)}})},showtip=function(e){if(e){const t=BODY.createChild("div",{innerHTML:e,className:"tip"});setTimeout(function(){t.addClass("hide"),setTimeout(function(){BODY.removeChild(t)},300)},3e3)}},resizeHandle=function(e){siteNavHeight=siteNav.height(),headerHightInner=siteHeader.height(),headerHight=headerHightInner+$dom("#waves").height(),oWinWidth!==window.innerWidth&&sideBarToggleHandle(null,1),oWinHeight=window.innerHeight,oWinWidth=window.innerWidth,sideBar.child(".panels").height(oWinHeight+"px")},scrollHandle=function(e){var t=window.innerHeight,o=getDocHeight(),o=t<o?o-t:document.body.scrollHeight-t,t=window.scrollY>headerHightInner,i=0<window.scrollY,i=(t?changeMetaTheme("#FFF"):changeMetaTheme("#222"),siteNav.toggleClass("show",t),toolBtn.toggleClass("affix",i),siteBrand.toggleClass("affix",i),sideBar.toggleClass("affix",window.scrollY>headerHight&&991<document.body.offsetWidth),void 0===scrollAction.y&&(scrollAction.y=window.scrollY),(diffY=scrollAction.y-window.scrollY)<0?(siteNav.removeClass("up"),siteNav.toggleClass("down",t)):0<diffY&&(siteNav.removeClass("down"),siteNav.toggleClass("up",t)),scrollAction.y=window.scrollY,Math.round(Math.min(100*window.scrollY/o,100))+"%");backToTop.child("span").innerText=i,$dom(".percent").width(i)},pagePosition=function(){CONFIG.auto_scroll&&$storage.set(LOCAL_URL,String(scrollAction.y))},positionInit=function(e){var t,o=window.location.hash;LOCAL_HASH?$storage.del(LOCAL_URL):((t=o?$dom(decodeURI(o)):CONFIG.auto_scroll?parseInt($storage.get(LOCAL_URL)):0)&&(pageScroll(t),LOCAL_HASH=1),e&&o&&!LOCAL_HASH&&(pageScroll(t),LOCAL_HASH=1))},clipBoard=function(e,t){if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(e).then(()=>{t&&t(!0)},()=>{t&&t(!1)});else{const i=BODY.createChild("textarea",{style:{top:window.scrollY+"px",position:"absolute",opacity:"0"},readOnly:!0,value:e}),a=document.getSelection();var o=0<a.rangeCount&&a.getRangeAt(0),e=(i.select(),i.setSelectionRange(0,e.length),i.readOnly=!1,document.execCommand("copy"));t&&t(e),i.blur(),o&&(a.removeAllRanges(),a.addRange(o)),BODY.removeChild(i)}};