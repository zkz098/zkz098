const statics=CONFIG.statics.indexOf("//")>0?CONFIG.statics:CONFIG.root,scrollAction={x:void 0,y:void 0};let originTitle,titleTime,diffY=0;const BODY=document.getElementsByTagName("body")[0],HTML=document.documentElement,Container=$dom("#container"),loadCat=$dom("#loading"),siteNav=$dom("#nav"),siteHeader=$dom("#header"),menuToggle=siteNav.child(".toggle"),quickBtn=$dom("#quick"),sideBar=$dom("#sidebar"),siteBrand=$dom("#brand");let toolPlayer,backToTop,goToComment,showContents,siteNavHeight,headerHightInner,headerHight,pjax,toolBtn=$dom("#tool"),siteSearch=$dom("#search"),oWinHeight=window.innerHeight,oWinWidth=window.innerWidth,LOCAL_HASH=0,LOCAL_URL=window.location.href;const changeTheme=function(e){const t=$dom(".theme .ic");"dark"===e?(HTML.attr("data-theme",e),t.removeClass("i-sun"),t.addClass("i-moon")):(HTML.attr("data-theme",null),t.removeClass("i-moon"),t.addClass("i-sun"))},autoDarkmode=function(){CONFIG.auto_dark.enable&&((new Date).getHours()>=CONFIG.auto_dark.start||(new Date).getHours()<=CONFIG.auto_dark.end||window.matchMedia("(prefers-color-scheme:dark)").matches?changeTheme("dark"):changeTheme())},lazyload=lozad("img, [data-background-image]",{loaded:function(e){e.addClass("lozaded")}}),Loader={timer:null,lock:!1,show:function(){clearTimeout(this.timer),document.body.removeClass("loaded"),loadCat.attr("style","display:block"),Loader.lock=!1},hide:function(e){CONFIG.loader.start||(e=-1),this.timer=setTimeout(this.vanish,e||3e3)},vanish:function(){Loader.lock||(CONFIG.loader.start&&transition(loadCat,0),document.body.addClass("loaded"),Loader.lock=!0)}},changeMetaTheme=function(e){"dark"===HTML.attr("data-theme")&&(e="#222"),$dom('meta[name="theme-color"]').attr("content",e)},themeColorListener=function(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(function(e){e.matches?changeTheme("dark"):changeTheme()}));const e=$storage.get("theme");e?changeTheme(e):CONFIG.darkmode&&changeTheme("dark"),$dom(".theme").addEventListener("click",(function(e){let t;const o=e.currentTarget.child(".ic"),i=BODY.createChild("div",{id:"neko",innerHTML:'<div class="planet"><div class="sun"></div><div class="moon"></div></div><div class="body"><div class="face"><section class="eyes left"><span class="pupil"></span></section><section class="eyes right"><span class="pupil"></span></section><span class="nose"></span></div></div>'}),n=function(){transition(i,{delay:2500,opacity:0},(function(){BODY.removeChild(i)}))};o.hasClass("i-sun")?t=function(){i.addClass("dark"),changeTheme("dark"),$storage.set("theme","dark"),n()}:(i.addClass("dark"),t=function(){i.removeClass("dark"),changeTheme(),$storage.set("theme","light"),n()}),transition(i,1,(function(){setTimeout(t,210)}))}))},visibilityListener=function(){let e=$dom('[rel="icon"]');document.addEventListener("visibilitychange",(function(){switch(document.visibilityState){case"hidden":e.attr("href",statics+CONFIG.favicon.hidden),document.title=LOCAL.favicon.hide,CONFIG.loader.switch&&Loader.show(),clearTimeout(titleTime);break;case"visible":e.attr("href",statics+CONFIG.favicon.normal),document.title=LOCAL.favicon.show,CONFIG.loader.switch&&Loader.hide(1e3),titleTime=setTimeout((function(){document.title=originTitle}),2e3)}}))},showtip=function(e){if(!e)return;const t=BODY.createChild("div",{innerHTML:e,className:"tip"});setTimeout((function(){t.addClass("hide"),setTimeout((function(){BODY.removeChild(t)}),300)}),3e3)},resizeHandle=function(e){siteNavHeight=siteNav.height(),headerHightInner=siteHeader.height(),headerHight=headerHightInner+$dom("#waves").height(),oWinWidth!==window.innerWidth&&sideBarToggleHandle(null,1),oWinHeight=window.innerHeight,oWinWidth=window.innerWidth,sideBar.child(".panels").height(oWinHeight+"px")},scrollHandle=function(e){const t=window.innerHeight,o=getDocHeight(),i=o>t?o-t:document.body.scrollHeight-t,n=window.scrollY>headerHightInner,a=window.scrollY>0;var s;s=n?"#FFF":"#222","dark"===HTML.attr("data-theme")&&(s="#222"),$dom('meta[name="theme-color"]').attr("content",s),siteNav.toggleClass("show",n),toolBtn.toggleClass("affix",a),siteBrand.toggleClass("affix",a),sideBar.toggleClass("affix",window.scrollY>headerHight&&document.body.offsetWidth>991),void 0===scrollAction.y&&(scrollAction.y=window.scrollY),diffY=scrollAction.y-window.scrollY,diffY<0?(siteNav.removeClass("up"),siteNav.toggleClass("down",n)):diffY>0&&(siteNav.removeClass("down"),siteNav.toggleClass("up",n)),scrollAction.y=window.scrollY;const d=Math.round(Math.min(100*window.scrollY/i,100))+"%";backToTop.child("span").innerText=d,$dom(".percent").width(d)},pagePosition=function(){CONFIG.auto_scroll&&$storage.set(LOCAL_URL,String(scrollAction.y))},positionInit=function(e){const t=window.location.hash;let o=null;LOCAL_HASH?$storage.del(LOCAL_URL):(o=t?$dom(decodeURI(t)):CONFIG.auto_scroll?parseInt($storage.get(LOCAL_URL)):0,o&&(pageScroll(o),LOCAL_HASH=1),e&&t&&!LOCAL_HASH&&(pageScroll(o),LOCAL_HASH=1))},clipBoard=function(e,t){if(navigator.clipboard&&window.isSecureContext)navigator.clipboard.writeText(e).then((()=>{t&&t(!0)}),(()=>{t&&t(!1)}));else{const o=BODY.createChild("textarea",{style:{top:window.scrollY+"px",position:"absolute",opacity:"0"},readOnly:!0,value:e}),i=document.getSelection(),n=i.rangeCount>0&&i.getRangeAt(0);o.select(),o.setSelectionRange(0,e.length),o.readOnly=!1;const a=document.execCommand("copy");t&&t(a),o.blur(),n&&(i.removeAllRanges(),i.addRange(n)),BODY.removeChild(o)}};