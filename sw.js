const CACHE_NAME="KaitakuCDNCache";let cachelist=[],flag=!1;const cdn={gh:{jsdelivr:{url:"https://cdn.jsdelivr.net/gh"},jsdelivr_fastly:{url:"https://fastly.jsdelivr.net/gh"},jsdelivr_kaitaku:{url:"https://jsd.kaitaku.xyz/gh"}},cdnjs:{staticfile:{url:"https://cdn.staticfile.org"},cdnjs_cf:{url:"https://cdnjs.cloudflare.com/ajax/libs"},baomitu:{url:"https://lib.baomitu.com"},bytedance:{url:"https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M"}},npm:{eleme:{url:"https://npm.elemecdn.com"},sourcegcdn:{url:"https://npm.sourcegcdn.com"},unpkg:{url:"https://unpkg.com"},tianli:{url:"https://cdn1.tianli0.top/npm"}}},info=e=>{console.log(`%c INFO %c ${e}`,"color: white; background: #32cd32; padding: 5px 3px;","padding: 4px;border:1px solid #32cd32")},warn=e=>{console.log(`%c WARN %c ${e}`,"color: white; background: #ffd700; padding: 5px 3px;","padding: 4px;border:1px solid #ffd700")},err=e=>{console.log(`%c ERROR %c ${e}`,"color: white; background: #ff0000; padding: 5px 3px;","padding: 4px;border:1px solid #ff0000")},handleerr=async(e,t)=>new Response(`<h1>KaitakuCDNCache遇到了致命错误</h1>\n    <b>${t}</b>`,{headers:{"content-type":"text/html; charset=utf-8"}}),file_found=(e,t)=>e.indexOf(t)>-1,handle=async e=>{const t=e.url,n=e.url.split("/")[2];let c=[];if(file_found(t,"woff")||file_found(t,"cover.jpg")||file_found(t,"ico"))return caches.match(e).then((function(n){return n||fetch(t).then((function(t){return caches.open(CACHE_NAME).then((function(n){return n.put(e,t.clone()),t}))}))}));if(n.match("www.kaitaku.xyz"))return fetch(e.url).then((function(t){if(!t)throw"error";return caches.open(CACHE_NAME).then((function(n){return n.delete(e),n.put(e,t.clone()),t}))})).catch((function(t){return caches.match(e).then((function(e){return e||caches.match(new Request("/offline.html"))}))}));if(n.match("fundingchoicesmessages.google.com"))return info("fetch fundingchoicesmessages succeed"),fetch(e.url.replace("https://fundingchoicesmessages.google.com","https://adsenseabc.vercel.app"));if(file_found(t,"www.google.com/recaptcha/"))return info("fetch recaptcha succeed"),fetch(e.url.replace("https://www.google.com","https://www.recaptcha.net"));for(let r in cdn)for(let s in cdn[r])if(n===cdn[r][s].url.split("https://")[1].split("/")[0]&&t.match(cdn[r][s].url)){info(`capture ${t}`),c=[];for(let e in cdn[r])c.push(t.replace(cdn[r][s].url,cdn[r][e].url));return t.indexOf("@latest/")>-1?lfetch(c,t):caches.match(e).then((function(n){return n||lfetch(c,t).then((function(t){return caches.open(CACHE_NAME).then((function(n){return n.put(e,t.clone()),t}))}))}))}return fetch(e)},lfetch=async(e,t)=>{info(`lfetch handle! | mirrors: ${e.length}`);let n=new AbortController;const c=async e=>new Response(await e.arrayBuffer(),{status:e.status,headers:e.headers});return Promise.any||(Promise.any=function(e){return new Promise(((t,n)=>{let c=(e=Array.isArray(e)?e:[]).length,r=[];if(0===c)return n(new AggregateError("All promises were rejected"));e.forEach((e=>{e.then((e=>{t(e)}),(e=>{c--,r.push(e),0===c&&n(new AggregateError(r))}))}))}))}),Promise.any(e.map((e=>new Promise(((t,r)=>{fetch(e,{signal:n.signal}).then(c).then((async e=>{200===e.status?(n.abort(),t(e)):r(e)})).catch((async e=>{var t;flag||(t="fetch: "+e,console.log(`%c WARN %c ${t}`,"color: white; background: #ffd700; padding: 5px 3px;","padding: 4px;border:1px solid #ffd700"),flag=!0)}))})))))};self.addEventListener("install",(async e=>{self.skipWaiting(),e.waitUntil(caches.open(CACHE_NAME).then((e=>(info(`${CACHE_NAME} Opened`),info(`${CACHE_NAME} start running`),e.addAll(cachelist)))))})),self.addEventListener("activate",(async function(e){self.clients.claim()})),self.addEventListener("fetch",(async e=>{try{e.respondWith(handle(e.request))}catch(t){e.respondWith(handleerr(e.request,t))}}));